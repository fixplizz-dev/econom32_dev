# üê≥ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã - –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

## –û–±–∑–æ—Ä –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç 8 —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤, –∫–∞–∂–¥—ã–π –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö –≤—ã–ø–æ–ª–Ω—è–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—É—é —Ä–æ–ª—å –≤ —ç–∫–æ—Å–∏—Å—Ç–µ–º–µ —Å–∞–π—Ç–∞ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞:

| –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä | –†–æ–ª—å | –ü–æ—Ä—Ç—ã | –†–µ—Å—É—Ä—Å—ã | –°—Ç–∞—Ç—É—Å |
|-----------|------|-------|---------|--------|
| **PostgreSQL** | –û—Å–Ω–æ–≤–Ω–∞—è –ë–î | 5432 | 200MB RAM | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| **Redis** | –ö—ç—à –∏ —Å–µ—Å—Å–∏–∏ | 6379 | 50MB RAM | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| **MinIO** | –§–∞–π–ª–æ–≤–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ | 9000, 9001 | 100MB RAM | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| **ClamAV** | –ê–Ω—Ç–∏–≤–∏—Ä—É—Å | 3310 | 500MB RAM | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| **Nginx** | –í–µ–±-—Å–µ—Ä–≤–µ—Ä | 80, 443 | 20MB RAM | ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ |
| **Adminer** | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ë–î | 8080 | 30MB RAM | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| **Prometheus** | –ú–µ—Ç—Ä–∏–∫–∏ | 9090 | 100MB RAM | ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ |
| **Grafana** | –î–∞—à–±–æ—Ä–¥—ã | 3000 | 150MB RAM | ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ |

## üóÑÔ∏è PostgreSQL - –°–µ—Ä–¥—Ü–µ —Å–∏—Å—Ç–µ–º—ã

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–û—Å–Ω–æ–≤–Ω–∞—è —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Å–∞–π—Ç–∞ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞.

### –°—Ö–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö
```sql
-- –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
Users          -- –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –∏ –∏—Ö —Ä–æ–ª–∏
News           -- –ù–æ–≤–æ—Å—Ç–∏ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞  
Pages          -- –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
Appeals        -- –û–±—Ä–∞—â–µ–Ω–∏—è –≥—Ä–∞–∂–¥–∞–Ω
Departments    -- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞
Employees      -- –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏
Documents      -- –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã
Comments       -- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –Ω–æ–≤–æ—Å—Ç—è–º
Categories     -- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
Tags           -- –¢–µ–≥–∏ –¥–ª—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
```yaml
# docker-compose.prod.yml
postgres:
  environment:
    POSTGRES_PASSWORD: ${POSTGRES_STRONG_PASSWORD}
    POSTGRES_INITDB_ARGS: "--encoding=UTF-8 --locale=ru_RU.UTF-8"
  deploy:
    resources:
      limits:
        memory: 2G
        cpus: '2'
  volumes:
    - postgres_data:/var/lib/postgresql/data
    - ./backups:/backups
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏—è**: –ú–∞–∫—Å–∏–º—É–º 100 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö
- **–†–∞–∑–º–µ—Ä –ë–î**: ~500MB (—Å —Ä–æ—Å—Ç–æ–º –¥–æ 5GB)
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: <100ms –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- **–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ï–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 3:00 –ú–°–ö

---

## üöÄ Redis - –¢—É—Ä–±–æ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–í—ã—Å–æ–∫–æ—Å–∫–æ—Ä–æ—Å—Ç–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å–µ—Å—Å–∏–π.

### –ß—Ç–æ –∫—ç—à–∏—Ä—É–µ—Ç—Å—è
```redis
# –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–ª—é—á–µ–π
session:${userId}:${sessionId}    # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å–µ—Å—Å–∏–∏
cache:news:latest                 # –ü–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏
cache:menu:structure              # –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
cache:stats:daily                 # –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
rate_limit:${ip}:${endpoint}      # –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ IP
```

### –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
- **TTL –¥–ª—è –Ω–æ–≤–æ—Å—Ç–µ–π**: 15 –º–∏–Ω—É—Ç
- **TTL –¥–ª—è –º–µ–Ω—é**: 1 —á–∞—Å  
- **TTL –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏**: 5 –º–∏–Ω—É—Ç
- **–°–µ—Å—Å–∏–∏**: 24 —á–∞—Å–∞ (—Å –ø—Ä–æ–¥–ª–µ–Ω–∏–µ–º)

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
```yaml
redis:
  command: |
    redis-server 
    --maxmemory 512mb 
    --maxmemory-policy allkeys-lru
    --appendonly yes
    --save 900 1
```

---

## üíæ MinIO - –ù–∞–¥–µ–∂–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Ñ–∞–π–ª–æ–≤

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
S3-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ–µ –æ–±—ä–µ–∫—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è –≤—Å–µ—Ö –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ buckets
```
econom32-public/          # –ü—É–±–ª–∏—á–Ω—ã–µ —Ñ–∞–π–ª—ã
‚îú‚îÄ‚îÄ news/                 # –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–æ–≤–æ—Å—Ç–µ–π
‚îú‚îÄ‚îÄ employees/            # –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
‚îú‚îÄ‚îÄ banners/              # –ë–∞–Ω–Ω–µ—Ä—ã –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
‚îî‚îÄ‚îÄ documents/            # –ü—É–±–ª–∏—á–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

econom32-private/         # –ü—Ä–∏–≤–∞—Ç–Ω—ã–µ —Ñ–∞–π–ª—ã
‚îú‚îÄ‚îÄ appeals/              # –§–∞–π–ª—ã –æ–±—Ä–∞—â–µ–Ω–∏–π –≥—Ä–∞–∂–¥–∞–Ω
‚îú‚îÄ‚îÄ backups/              # –†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏
‚îî‚îÄ‚îÄ temp/                 # –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

econom32-system/          # –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ñ–∞–π–ª—ã
‚îú‚îÄ‚îÄ logs/                 # –õ–æ–≥–∏ —Å–∏—Å—Ç–µ–º—ã
‚îî‚îÄ‚îÄ configs/              # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```

### –ü–æ–ª–∏—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Principal": {"AWS": "*"},
      "Action": "s3:GetObject",
      "Resource": "arn:aws:s3:::econom32-public/*"
    },
    {
      "Effect": "Deny",
      "Principal": {"AWS": "*"},
      "Action": "s3:*",
      "Resource": "arn:aws:s3:::econom32-private/*"
    }
  ]
}
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º
```typescript
// –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ —Å –∞–Ω—Ç–∏–≤–∏—Ä—É—Å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–æ–π
async function uploadFile(file: File, bucket: string) {
  // 1. –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ ClamAV
  const scanResult = await clamav.scanFile(file);
  if (!scanResult.clean) {
    throw new Error('–§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –≤–∏—Ä—É—Å');
  }
  
  // 2. –ó–∞–≥—Ä—É–∑–∫–∞ –≤ MinIO
  const result = await minioClient.putObject(bucket, file.name, file.buffer);
  
  // 3. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è URL
  return await minioClient.presignedGetObject(bucket, file.name, 24*60*60);
}
```

---

## üõ°Ô∏è ClamAV - –ê–Ω—Ç–∏–≤–∏—Ä—É—Å–Ω–∞—è –∑–∞—â–∏—Ç–∞

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–≥—Ä—É–∂–∞–µ–º—ã—Ö —Ñ–∞–π–ª–æ–≤ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –≤–∏—Ä—É—Å–æ–≤ –∏ –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω–æ–≥–æ –ü–û.

### –ü—Ä–æ—Ü–µ—Å—Å –ø—Ä–æ–≤–µ—Ä–∫–∏
```mermaid
sequenceDiagram
    participant User as –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
    participant API as Backend API
    participant ClamAV as ClamAV
    participant MinIO as MinIO
    
    User->>API: –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞
    API->>ClamAV: –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
    ClamAV-->>API: –†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏
    
    alt –§–∞–π–ª —á–∏—Å—Ç—ã–π
        API->>MinIO: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
        MinIO-->>API: URL —Ñ–∞–π–ª–∞
        API-->>User: –£—Å–ø–µ—à–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
    else –§–∞–π–ª –∑–∞—Ä–∞–∂–µ–Ω
        API-->>User: –û—à–∏–±–∫–∞: —Ñ–∞–π–ª –∑–∞—Ä–∞–∂–µ–Ω
    end
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```yaml
clamav:
  environment:
    CLAMAV_NO_FRESHCLAMD: "false"  # –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–∑
    CLAMAV_NO_CLAMD: "false"       # –í–∫–ª—é—á–∏—Ç—å –¥–µ–º–æ–Ω
  volumes:
    - clamav_data:/var/lib/clamav   # –ë–∞–∑–∞ –≤–∏—Ä—É—Å–Ω—ã—Ö —Å–∏–≥–Ω–∞—Ç—É—Ä
  healthcheck:
    test: ["CMD", "clamdscan", "--version"]
    interval: 30s
    timeout: 10s
    retries: 3
```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–∞–±–æ—Ç—ã
- **–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ —Ñ–∞–π–ª–æ–≤**: ~1000/–¥–µ–Ω—å
- **–ù–∞–π–¥–µ–Ω–æ —É–≥—Ä–æ–∑**: 0-2/–º–µ—Å—è—Ü
- **–í—Ä–µ–º—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è**: 1-5 —Å–µ–∫—É–Ω–¥/—Ñ–∞–π–ª
- **–†–∞–∑–º–µ—Ä –±–∞–∑—ã**: ~200MB (–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ)

---

## üåê Nginx - –í—Ö–æ–¥–Ω—ã–µ –≤–æ—Ä–æ—Ç–∞

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–û–±—Ä–∞—Ç–Ω—ã–π –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä, –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫ –Ω–∞–≥—Ä—É–∑–∫–∏ –∏ —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è –≤—Å–µ—Ö HTTP –∑–∞–ø—Ä–æ—Å–æ–≤.

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏
```nginx
# /etc/nginx/conf.d/default.conf
server {
    listen 80;
    server_name econom32.ru www.econom32.ru;
    
    # –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ HTTPS
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name econom32.ru www.econom32.ru;
    
    # SSL –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
    ssl_certificate /etc/nginx/ssl/econom32.crt;
    ssl_certificate_key /etc/nginx/ssl/econom32.key;
    
    # –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è
    location / {
        proxy_pass http://frontend:3001;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
    
    location /api/ {
        proxy_pass http://backend:3002;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
    
    location /files/ {
        proxy_pass http://minio:9000;
        proxy_set_header Host $host;
    }
}
```

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (—Ç—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏)
```nginx
# Security headers
add_header X-Frame-Options "SAMEORIGIN" always;
add_header X-Content-Type-Options "nosniff" always;
add_header X-XSS-Protection "1; mode=block" always;
add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;

# Content Security Policy
add_header Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline';" always;

# Rate limiting
limit_req_zone $binary_remote_addr zone=api:10m rate=10r/s;
limit_req zone=api burst=20 nodelay;
```

---

## üîç Adminer - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è PostgreSQL –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.

### –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- **–ü—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö**: –¢–∞–±–ª–∏—Ü—ã, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è, –∏–Ω–¥–µ–∫—Å—ã
- **–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ SQL**: –ó–∞–ø—Ä–æ—Å—ã, —Å–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤
- **–ò–º–ø–æ—Ä—Ç/—ç–∫—Å–ø–æ—Ä—Ç**: CSV, SQL –¥–∞–º–ø—ã
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –ê–∫—Ç–∏–≤–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è, –º–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã

### –î–æ—Å—Ç—É–ø
```bash
# URL: http://localhost:8080
# –°–µ—Ä–≤–µ—Ä: postgres
# –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: econom32_user
# –ü–∞—Ä–æ–ª—å: econom32_password
# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: econom32_new
```

### ‚ö†Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
```yaml
# –¢–æ–ª—å–∫–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏!
# –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
adminer:
  networks:
    - internal  # –¢–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å–µ—Ç—å
  environment:
    ADMINER_DESIGN: "hydra"
    ADMINER_DEFAULT_SERVER: "postgres"
```

---

## üìä Prometheus - –°–±–æ—Ä –º–µ—Ç—Ä–∏–∫

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ —Å–±–æ—Ä–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤ –º–µ—Ç—Ä–∏–∫.

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ü–µ–ª–µ–π
```yaml
# prometheus.yml
global:
  scrape_interval: 15s
  evaluation_interval: 15s

scrape_configs:
  - job_name: 'backend-api'
    static_configs:
      - targets: ['backend:3002']
    metrics_path: '/metrics'
    
  - job_name: 'postgres'
    static_configs:
      - targets: ['postgres-exporter:9187']
      
  - job_name: 'redis'
    static_configs:
      - targets: ['redis-exporter:9121']
      
  - job_name: 'node'
    static_configs:
      - targets: ['node-exporter:9100']
```

### –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏
```promql
# –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å API
http_request_duration_seconds{job="backend-api"}

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
pg_stat_database_tup_fetched{job="postgres"}

# –ö—ç—à Redis
redis_memory_used_bytes{job="redis"}

# –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã
node_memory_MemAvailable_bytes{job="node"}
```

---

## üìà Grafana - –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–°–æ–∑–¥–∞–Ω–∏–µ –¥–∞—à–±–æ—Ä–¥–æ–≤ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–ª–µ—Ä—Ç–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –º–µ—Ç—Ä–∏–∫ Prometheus.

### –û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞—à–±–æ—Ä–¥—ã

#### 1. –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã
- –°—Ç–∞—Ç—É—Å –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ (CPU, RAM, –¥–∏—Å–∫)
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞ API

#### 2. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ IP-–∞–¥—Ä–µ—Å–∞
- –ù–µ—É–¥–∞—á–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –≤—Ö–æ–¥–∞
- –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
- –°—Ç–∞—Ç—É—Å –∞–Ω—Ç–∏–≤–∏—Ä—É—Å–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫

#### 3. –ë–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫–∏
- –ü–æ—Å–µ—Ç–∏—Ç–µ–ª–∏ —Å–∞–π—Ç–∞
- –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- –û–±—Ä–∞—â–µ–Ω–∏—è –≥—Ä–∞–∂–¥–∞–Ω
- –°–∫–∞—á–∏–≤–∞–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–ª–µ—Ä—Ç–æ–≤
```yaml
# alerting/rules.yml
groups:
  - name: critical
    rules:
      - alert: SiteDown
        expr: up{job="backend-api"} == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "–°–∞–π—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"
          
      - alert: HighErrorRate
        expr: rate(http_requests_total{status=~"5.."}[5m]) > 0.1
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "–í—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –æ—à–∏–±–æ–∫"
```

---

## üöÄ –ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
docker-compose up -d

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
docker-compose ps

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs -f
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞–º–∏
```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
docker-compose restart postgres

# –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
docker-compose up -d --scale backend=3

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞–∑–æ–≤
docker-compose pull && docker-compose up -d
```

### –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# –ë—ç–∫–∞–ø PostgreSQL
docker-compose exec postgres pg_dump -U econom32_user econom32_new > backup.sql

# –ë—ç–∫–∞–ø MinIO
docker-compose exec minio mc mirror /data /backups

# –ë—ç–∫–∞–ø –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π
tar -czf configs-backup.tar.gz docker/
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
docker stats

# –õ–æ–≥–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
docker-compose logs clamav | grep -i "threat"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
docker-compose exec postgres pg_isready
docker-compose exec redis redis-cli ping
```

---

## ‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

### 1. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (–ú–ê–ö–°–ò–ú–ê–õ–¨–ù–´–ô –ü–†–ò–û–†–ò–¢–ï–¢)
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã (Let's Encrypt)
- [ ] –í–Ω–µ–¥—Ä–∏—Ç—å WAF (ModSecurity) –≤ Nginx
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å fail2ban –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –±—Ä—É—Ç—Ñ–æ—Ä—Å–∞
- [ ] –ò–∑–º–µ–Ω–∏—Ç—å –≤—Å–µ –ø–∞—Ä–æ–ª–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- [ ] –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º –ø–æ—Ä—Ç–∞–º

### 2. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫ –≤ Prometheus
- [ ] –°–æ–∑–¥–∞—Ç—å –¥–∞—à–±–æ—Ä–¥—ã –≤ Grafana
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∞–ª–µ—Ä—Ç—ã
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å —Å–∏—Å—Ç–µ–º–æ–π —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### 3. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Redis
- [ ] –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å PostgreSQL
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å CDN –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤
- [ ] –í–∫–ª—é—á–∏—Ç—å —Å–∂–∞—Ç–∏–µ –≤ Nginx

### 4. –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –°–æ–∑–¥–∞—Ç—å –ø–ª–∞–Ω –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ —Å–±–æ–µ–≤
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å health checks –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å

---

**–ó–∞–∫–ª—é—á–µ–Ω–∏–µ**: –î–∞–Ω–Ω–∞—è Docker-–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –Ω–∞–¥–µ–∂–Ω—É—é –æ—Å–Ω–æ–≤—É –¥–ª—è —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Å–∞–π—Ç–∞, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞.